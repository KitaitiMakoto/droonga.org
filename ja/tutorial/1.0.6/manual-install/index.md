---
title: "Droonga チュートリアル: インストールスクリプトを使わずにDroongaの構成サービスをセットアップする手順"
layout: ja
---

{% comment %}
##############################################
  THIS FILE IS AUTOMATICALLY GENERATED FROM
  "_po/ja/tutorial/1.0.6/manual-install/index.po"
  DO NOT EDIT THIS FILE MANUALLY!
##############################################
{% endcomment %}


* TOC
{:toc}

## チュートリアルのゴール

インストールスクリプトを使わずに、Droongaノードを手動でセットアップするための手順を学ぶこと。

## なぜ手動インストールが必要なのか？

`droonga-engine`と~droonga-http-server`のインストールスクリプトは、現在の所、いくつかの環境でのみ動作します:

 * Debian GNU/Linux (最新のリリース)
 * Ubuntu (最新のリリース、最新のLTS)
 * CentOS 7

それ以外の環境では、サービスを手動でインストールする必要があります。
（上記以外の環境に対応するための知識をお持ちの場合、是非プルリクエストをお送り下さい！）

このチュートリアルでは、`droonga-engine`と`droonga-http-server`をインストールスクリプトを使わずにセットアップする方法を解説します。

## 必要な物

 * 2GB以上の大きさのRAM。
   Gemパッケージ`rroonga`（`droonga-engine`によって要求されます）はネイティブ拡張を含んでおり、RAMの搭載量が小さいと、これをインストールすることができません。
 * RubyGemsのための`gem`コマンドが利用できる状態になっていること。
 * npmjs.orgのための`npm`コマンドが利用できる状態になっていること。

## サービスのインストール手順

 1. ネイティブ拡張を伴う`gem`や`npm`のパッケージをインストールするために必要な、プラットフォームごとのパッケージをインストールする。
    例えば、Ubuntuサーバであれば`apt`を使って以下のパッケージをインストールします：`ruby`, `ruby-dev`, `build-essential`, `nodejs`, `nodejs-legacy`, `npm` 
    CentOS 6.xサーバでは、以下の手順で必要な環境を用意できます:
    
        # yum -y groupinstall development
        # curl -L get.rvm.io | bash -s stable
        # source /etc/profile.d/rvm.sh
        # rvm reload
        # rvm install 2.1.2
        # yum -y install npm
    
 2. Gemパッケージ `droonga-engine` をインストールする。
    これはDroongaシステムの主要な機能を提供する、核となるコンポーネントです。
    
        # gem install droonga-engine
    
 3. npmパッケージ `droonga-http-server` をインストールする。
    これはHTTPのリクエストをDroongaネイティブのリクエストに変換するために必要な、フロントエンドとなるコンポーネントです。
    
        # npm install -g droonga-http-server
    
 4. 描くサービスのためのユーザを作成する。
    すべての設定ファイルと物理的なデータベースは、これらのユーザのホームディレクトリ以下に置かれます。
    
        # useradd -m droonga-engine
        # useradd -m droonga-http-server
    
 5. 設定の置き場所となる`droonga`ディレクトリを、各ユーザのホーム直下に作成する。
    
        # mkdir ~droonga-engine/droonga
        # mkdir ~droonga-http-server/droonga
    
 6. そのノードの名前として、アクセス可能なホスト名またはIPアドレスを定義する。
    [この名前は、他のコンピュータから名前解決できる必要があります。](../groonga/#accessible-host-name)
    
        # host=192.168.100.50
    
 7. `droonga-engine`用の設定ファイル`droonga-engine.yaml`と`catalog.json`を作成する。
    今の所、指定する必要があるのはそのノード自身の名前だけです。
    
        # cd ~droonga-engine/droonga
        # droonga-engine-configure --quiet --reset-config --reset-catalog \
                                   --host=$host \
                                   --daemon \
                                   --pid-file=droogna-engine.pid
        # chown -R droogna-engine:droonga-engine ~droonga-engine/droonga
    
 8. `droonga-http-server`用の設定ファイル`droonga-http-server.yaml`を作成する。
    今の所、指定する必要があるのは接続先にするdroonga-engineノードの名前と、そのノード自身の名前だけです。
    例えば、両方のサービスがそのコンピュータの上で動作するのであれば以下のようにします:
    
        # cd ~droonga-http-server/droonga
        # droonga-http-server-configure --quiet --reset-config \
                                        --droonga-engine-host-name=$host \
                                        --receiver-host-name=$host \
                                        --daemon \
                                        --pid-file=droonga-http-server.pid
        # chown -R droogna-http-server:droonga-http-server ~droonga-http-server/droonga

## サービスの起動方法 {#start-services}

`droonga-engine`サービスを起動するには、以下のように、設定ディレクトリで`droonga-engine`コマンドを実行します:

    # cd ~droonga-engine/droonga
    # sudo -u droogna-engine -H droonga-engine

`droonga-http-server`サービスを起動するには、以下のように、設定ディレクトリで`droonga-http-server`コマンドを実行します:

    # cd ~droonga-http-server/droonga
    # sudo -u droogna-http-server -H droonga-http-server

すると、PIDファイルが自動的に作成され、サービスがデーモンとして動作し始めます。

## サービスの停止方法 {#stop-services}

`droonga-engine`サービスを停止するには、以下のように`droonga-engine-stop`コマンドを実行します:

    # cd ~droonga-engine/droonga
    # sudo -u droogna-engine -H droonga-engine-stop

`droonga-http-server`サービスを停止するには、以下のように`droonga-http-server-stop`コマンドを実行します:

    # cd ~droonga-http-server/droonga
    # sudo -u droogna-http-server -H droonga-http-server-stop

これらのコマンドはPIDファイルの位置を自動的に検出し、デーモンのプロセスを停止します。

