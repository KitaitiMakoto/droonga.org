---
title: add
layout: documents_ja
---

* TOC
{:toc}

## 概要 {#abstract}

`add` は、テーブルにレコードを登録します。

対象のテーブルが主キーを持っており、同じキーのレコードが既に存在している場合には、既存レコードのカラムの値を更新します。

`add` はRequest-Response型のコマンドです。コマンドに対しては必ず対応するレスポンスが返されます。

## 構文 {#syntax}

対象のテーブルが主キーを持つ場合：

    {
      "table"  : "テーブル名",
      "key"    : "主キー",
      "values" : {
        "カラム名1" : 値1,
        "カラム名2" : 値2,
        ...
      }
    }

対象のテーブルが主キーを持たない場合：

    {
      "table"  : "テーブル名",
      "values" : {
        "カラム名1" : 値1,
        "カラム名2" : 値2,
        ...
      }
    }

## 使い方 {#usage}

典型的な使い方を通じて、`add` コマンドの働きを説明します。

なお、本項の説明では以下のような2つのテーブルが存在している事を前提とします。

Personテーブル（主キー無し）:

|name|job（Jobテーブルを参照）|
|Alice Arnold|announcer|
|Alice Cooper|musician|

Jobテーブル（主キー有り）:

|_key|label|
|announcer|アナウンサー|
|musician|ミュージシャン|


### 主キーを持たないテーブルにレコードを追加する {#adding-record-to-table-without-key}

主キーを持たないテーブルにレコードを追加する場合は、 `key` を指定せずに `table` と `values` だけを指定します。

    add
    {
      "table"  : "Person",
      "values" : {
        "name" : "Bob Dylan",
        "job"  : "musician"
      }
    }
    
    => add.result
       true

`add` は再帰的に動作します。別のテーブルを参照しているカラムについて、参照先のテーブルに存在しない値を指定した場合、エラーにはならず、参照先のテーブルにも同時に新しいレコードが追加されます。例えば、以下は  テーブルに存在しない主キー `doctor` を伴って Person テーブルにレコードを追加します。

    add
    {
      "table"  : "Person",
      "values" : {
        "name" : "Alice Miller",
        "job"  : "doctor"
      }
    }
    
    => add.result
       true

この時、Jobテーブルには主キーだけが指定された新しいレコードが自動的に追加されます。

|_key|label|
|announcer|アナウンサー|
|musician|ミュージシャン|
|doctor|（空文字）|


### 主キーを持つテーブルにレコードを追加する {#adding-record-to-table-with-key}

主キーを持つテーブルにレコードを追加する場合は、 `table`、`key`、`values` のすべてを指定します。

    add
    {
      "table"  : "Job",
      "key"    : "writer",
      "values" : {
        "label" : "作家"
      }
    }
    
    => add.result
       true

### 既存レコードのカラムの値を更新する {#updating}

主キーを持つテーブルに対する、既存レコードの主キーを伴う `add` コマンドは、既存レコードのカラムの値の更新操作と見なされます。

    add
    {
      "table"  : "Job",
      "key"    : "doctor",
      "values" : {
        "label" : "医師"
      }
    }
    
    => add.result
       true


主キーを持たないテーブルのレコードに対しては、値の更新操作はできません（常にレコードの追加と見なされます）。


## パラメータ {#parameters}

### `table` {#parameter-table}

概要
: レコードを登録するテーブルの名前を指定します。

値
: テーブル名の文字列。

省略時の既定値
: なし。このパラメータは必須です。

### `key` {#parameter-key}

概要
: レコードの主キーを指定します。

値
: 主キーとなる文字列。

省略時の初期値
: なし。対象のテーブルが主キーを持つ場合、このパラメータは必須です。主キーがない場合、このパラメータは無視されます。

既に同じ主キーを持つレコードが存在している場合は、レコードの各カラムの値を更新します。

対象のテーブルが主キーを持たない場合は、指定しても単に無視されます。

### `values` {#parameter-values}

概要
: レコードの各カラムの値を指定します。

値
: カラム名をキー、カラムの値を値としたハッシュ。

省略時の初期値
: `null`

指定されなかったカラムの値は登録・更新されません。


## レスポンス {#response}

このコマンドは、レスポンスとしてレコードの登録の成否を示す真偽値を含んだ配列を返却します。

 * `[true]`：レコードの登録に成功した。
 * `[false]`：レコードの登録に失敗した。
